from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

from database import Base
from main import app
from utils import get_db
from session import COOKIE_KEY, JWT_SCERET

SQLALCHEMY_DATABASE_URL = "postgresql://postgres:Pass%40Po-es.15@127.0.0.1/rlm_test"

engine = create_engine(SQLALCHEMY_DATABASE_URL)
TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)


Base.metadata.create_all(bind=engine)


authorized_jwt_token = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM5YWZkYTM2ODJlYmYwOWViMzA1NWMxYzRiZDM5Yjc1MWZiZjgxOTUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2ODI3NTM2NjQsImF1ZCI6IjY1ODIwODUwOTg2OC1lb2J1dnI4cG5iNWsxa25xOTFjcTI3dGw3OTRycDY3bC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwNTcxMjU1OTI1MDg0NDQxMjc4NSIsImhkIjoiaWl0aC5hYy5pbiIsImVtYWlsIjoiY3MxOWJ0ZWNoMTEwNTJAaWl0aC5hYy5pbiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhenAiOiI2NTgyMDg1MDk4NjgtZW9idXZyOHBuYjVrMWtucTkxY3EyN3RsNzk0cnA2N2wuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJuYW1lIjoiUEVMTFVSSSBTUklWQVJESEFOIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FHTm15eGJjNENVd3E5REV0MEJzUFl0T192VEhkQUoxNjFCLVVxVWdfY0pILVE9czk2LWMiLCJnaXZlbl9uYW1lIjoiUEVMTFVSSSIsImZhbWlseV9uYW1lIjoiU1JJVkFSREhBTiIsImlhdCI6MTY4Mjc1Mzk2NCwiZXhwIjoxNjgyNzU3NTY0LCJqdGkiOiJiZGEyZWJlZTdmZjI4OTZjZDEyNzYzM2U0N2M5MzU5MDQ3MmM3ZGMxIn0.WsLFx1eGIe-4-G2MIza84XK6LvUPrRYv4pLLgwvLw_QZxtG0If6OjZQTBusiUCEqZrZ0EmmwfVZjuzpp5kws0VC4lIxd5T35K9VAkJikhTYcYWv2SOTbURYlegEd0mQHwUh4Fw2ZlUnGsEJnyNtoC3SmjLExV3inLEjTMx7AO6u-OTokRmfvnh_ZvJOB4O48BbCv9SxVWP3WD5A9xKBAWLhWI6wPOO8X1NIMcq-DohxTwCp42NQzWbUJQpr4ROy87GB3SzLb519dK77ZT1sTQiPaPklIW34fPCqPN93WdxlhU2PT8YdptOz1iviTaADjDbSgYdu0cYK9HT3879YvhQ"
unauthorized_jwt_token = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM5YWZkYTM2ODJlYmYwOWViMzA1NWMxYzRiZDM5Yjc1MWZiZjgxOTUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2ODI3NTM2NjQsImF1ZCI6IjY1ODIwODUwOTg2OC1lb2J1dnI4cG5iNWsxa25xOTFjcTI3dGw3OTRycDY3bC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwNTcxMjU1OTI1MDg0NDQxMjc4NSIsImhkIjoiaWl0aC5hYy5pbiIsImVtYWlsIjoiY3MxOWJ0ZWNoMTEwNTJAaWl0aC5hYy5pbiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhenAiOiI2NTgyMDg1MDk4NjgtZW9idXZyOHBuYjVrMWtucTkxY3EyN3RsNzk0cnA2N2wuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJuYW1lIjoiUEVMTFVSSSBTUklWQVJESEFOIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FHTm15eGJjNENVd3E5REV0MEJzUFl0T192VEhkQUoxNjFCLVVxVWdfY0pILVE9czk2LWMiLCJnaXZlbl9uYW1lIjoiUEVMTFVSSSIsImZhbWlseV9uYW1lIjoiU1JJVkFSREhBTiIsImlhdCI6MTY4Mjc1Mzk2NCwiZXhwIjoxNjgyNzU3NTY0LCJqdGkiOiJiZGEyZWJlZTdmZjI4OTZjZDEyNzYzM2U0N2M5MzU5MDQ3MmM3ZGMxIn0.WsLFx1eGIe-4-G2MIza84XK6LvUPrRYv4pLLgwvLw_QZxtG0If6OjZQTBusiUCEqZrZ0EmmwfVZjuzpp5kws0VC4lIxd5T35K9VAkJikhTYcYWv2SOTbURYlegEd0mQHwUh4Fw2ZlUnGsEJnyNtoC3SmjLExV3inLEjTMx7AO6u-OTokRmfvnh_ZvJOB4O48BbCv9SxVWP3WD5A9xKBAWLhWI6wPOO8X1NIMcq-DohxTwCp42NQzWbUJQpr4ROy87GB3SzLb519dK77ZT1sTQiPaPklIW34fPCqPN93WdxlhU2PT8YdptOz1iviTaADjDbSgYdu0cYK9HT3879Y"

def override_get_db():
    try:
        db = TestingSessionLocal()
        yield db
    finally:
        db.close()

app.dependency_overrides[get_db] = override_get_db

client = TestClient(app)
